function Transfer(b,a,c){this.url=b;this.callback=a;this.options=this.extend({localProxy:"/favicon.ico",defaultName:"cross.default.name"},c);this.init()}
Transfer.prototype={init:function(){this.params=this.options.params||{};this.params.windowname=1;delete this.options.params;this.files=this.options.files||[];delete this.options.files;var b="transfer_"+(new Date).getTime();this.options.defaultName=b;var a;a=null;try{a=document.createElement('<iframe name="'+b+'">')}catch(c){}if(!a||"IFRAME"!=a.nodeName)a=document.createElement("iframe"),a.name=b;a.name=b;a.style.display="none";a.style.position="fixed";a.style.top=a.style.left="-10000px";document.body.appendChild(a);
var d=document.createElement("form");d.style.display="none";d.target=b;d.action=this.url;d.method="post";d.encoding=d.enctype="application/x-www-form-urlencoded";document.body.appendChild(d);this.frame=a;this.form=d;this.state=1;this._setRequest()},_setRequest:function(){function b(){try{if("about:blank"==c.contentWindow.location.href)return}catch(b){}if(3==a.state){var e=!1;try{e=c.contentWindow.location.host==location.host}catch(h){}if(e){if(c.readyState&&"complete"!=c.readyState.toLowerCase())return;
e=c.contentWindow.name;e==g.defaultName&&(e='{"error": 1}');a.callback(e);c.onreadystatechange=c.onload=null;c.parentNode.removeChild(c);if(d){for(var i=0,l=a._files.length;i<l;i++)e=a._files[i],e[2].insertBefore(e[0],e[1]),e[2].removeChild(e[1]);a._files=[];d.parentNode.removeChild(d)}d=c=null;for(var k in a)a.hasOwnProperty(k)&&(a[k]=null,delete a[k])}else c.contentWindow.location=f}2==a.state&&(c.contentWindow.location=f,a.state=3)}var a=this,c=a.frame,d=a.form,g=a.options,f=g.localProxy;void 0!==
c.onreadystatechange?c.onreadystatechange=b:c.onload=b},send:function(){function b(a,c){var b=document.createElement("input");b.name=a;b.value=c;return b}var a=this.params,c=this.files,d=this.form,g,f,j=Object.prototype.toString;for(g in a)if(a.hasOwnProperty(g))if(f=a[g],"[object Array]"===j.call(f))for(var e=g+"[]",h=0,i=f.length;h<i;h++)d.appendChild(b(e,f[h]));else d.appendChild(b(g,f));j=this._files=[];e=c.length;if(0<e){d.encoding=d.enctype="multipart/form-data";for(h=0;h<e;h++)a=c[h],g=a.parentNode,
f=a.cloneNode(),f.disabled="disabled",j.push([a,f,g]),g.insertBefore(f,a),d.appendChild(a)}a=g=f=null;d.submit();this.state=2},isObject:function(b){return"[object Object]"==Object.prototype.toString.call(b)&&!b.nodeType},isArray:function(b){return"[object Array]"==Object.prototype.toString.call(b)},extend:function(b,a){var c=this.clone(a),d;for(d in c)c.hasOwnProperty(d)&&(b[d]=c[d]);return b},clone:function(b){var a;if(this.isArray(b)){a=[];for(var c=0,d=b.length;c<d;c++)a.push(this.clone(b[c]))}else if(this.isObject(b))for(c in a=
{},b)b.hasOwnProperty(c)&&(a[c]=this.clone(b[c]));else a=b;return a}};
